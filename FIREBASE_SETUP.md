# إعداد Firebase لحل مشكلة الصلاحيات

## المشكلة
كانت تظهر رسالة خطأ عند إضافة حجز من قبل المدير:
```
I/flutter ( 5304): Error adding booking: [cloud_firestore/permission-denied] The caller does not have permission to execute the specified operation.
```

## الحل
تم تحديث قواعد Firestore لتكون أكثر أماناً وتتحقق من دور المستخدم.

## خطوات التطبيق

### 1. نشر قواعد Firestore الجديدة
```bash
# تأكد من تثبيت Firebase CLI
npm install -g firebase-tools

# تسجيل الدخول إلى Firebase
firebase login

# تحديد المشروع
firebase use your-project-id

# نشر قواعد Firestore
firebase deploy --only firestore:rules
```

### 2. التحقق من إعدادات المشروع
تأكد من أن ملف `firebase_options.dart` يحتوي على معرف المشروع الصحيح.

### 3. اختبار الصلاحيات
- سجل دخول كمدير
- حاول إضافة حجز جديد
- تأكد من عدم ظهور رسالة الخطأ

## التغييرات المطبقة

### قواعد Firestore الجديدة
- التحقق من دور المستخدم (admin, photographer, client)
- السماح للمديرين بإنشاء وتعديل وحذف جميع الحجوزات
- السماح للعملاء بإنشاء حجوزات خاصة بهم
- السماح للمصورين بتحديث الحجوزات المخصصة لهم

### تحديثات الكود
- إضافة التحقق من دور المستخدم في `FirestoreService`
- تحسين معالجة الأخطاء في شاشة إضافة الحجز
- إضافة رسائل خطأ واضحة للمستخدم

## ملاحظات مهمة
1. تأكد من أن المستخدم لديه دور "admin" في قاعدة البيانات
2. قد تحتاج لإعادة تسجيل الدخول بعد تطبيق القواعد الجديدة
3. تأكد من أن جميع المستخدمين لديهم دور محدد في مجموعة "users"

## استكشاف الأخطاء
إذا استمرت المشكلة:
1. تحقق من سجلات Firebase Console
2. تأكد من أن المستخدم مصادق عليه
3. تحقق من أن المستخدم موجود في مجموعة "users"
4. تأكد من أن حقل "role" يحتوي على قيمة صحيحة
